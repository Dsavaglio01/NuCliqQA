{"version":3,"sources":["OperationSelection.tsx"],"names":["React","StyleSheet","View","TouchableOpacity","ScrollView","Icon","IconButton","editingModeState","useRecoilState","useContext","EditorContext","useMemo","operations","transform","title","iconID","operationID","adjust","OperationSelection","allowedTransformOperations","allowedAdjustmentOperations","isTransformOnly","isAdjustmentOnly","selectedOperationGroup","setSelectedOperationGroup","useState","setEditingMode","filteredOperations","filteredTransforms","filter","op","includes","filteredAdjustments","styles","opRow","map","item","index","opContainer","modeRow","modeButton","backgroundColor","create","height","width","justifyContent","alignItems","marginLeft","flexDirection","flex"],"mappings":"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","sourcesContent":["import * as React from \"react\";\r\nimport {\r\n  Platform,\r\n  StyleSheet,\r\n  View,\r\n  TouchableOpacity,\r\n  ScrollView,\r\n} from \"react-native\";\r\nimport { Icon } from \"../components/Icon\";\r\nimport { IconButton } from \"../components/IconButton\";\r\nimport { editingModeState, EditingModes } from \"../Store\";\r\nimport { useRecoilState } from \"recoil\";\r\nimport { useContext } from \"react\";\r\nimport {\r\n  AdjustmentOperations,\r\n  EditingOperations,\r\n  EditorContext,\r\n  TransformOperations,\r\n} from \"..\";\r\nimport { useMemo } from \"react\";\r\n\r\ninterface Operation<T> {\r\n  title: string;\r\n  iconID: React.ComponentProps<typeof Icon>[\"iconID\"];\r\n  operationID: T;\r\n}\r\n\r\ninterface Operations {\r\n  transform: Operation<TransformOperations>[];\r\n  adjust: Operation<AdjustmentOperations>[];\r\n}\r\n\r\nconst operations: Operations = {\r\n  transform: [\r\n    {\r\n      title: \"Crop\",\r\n      iconID: \"crop\",\r\n      operationID: \"crop\",\r\n    },\r\n    {\r\n      title: \"Rotate\",\r\n      iconID: \"rotate-90-degrees-ccw\",\r\n      operationID: \"rotate\",\r\n    },\r\n  ],\r\n  adjust: [\r\n    {\r\n      title: \"Blur\",\r\n      iconID: \"blur-on\",\r\n      operationID: \"blur\",\r\n    },\r\n  ],\r\n};\r\n\r\nexport function OperationSelection() {\r\n  //\r\n  const { allowedTransformOperations, allowedAdjustmentOperations } =\r\n    useContext(EditorContext);\r\n\r\n  const isTransformOnly =\r\n    allowedTransformOperations && !allowedAdjustmentOperations;\r\n  const isAdjustmentOnly =\r\n    allowedAdjustmentOperations && !allowedTransformOperations;\r\n\r\n  const [selectedOperationGroup, setSelectedOperationGroup] = React.useState<\r\n    \"transform\" | \"adjust\"\r\n  >(isAdjustmentOnly ? \"adjust\" : \"transform\");\r\n\r\n  const [, setEditingMode] = useRecoilState(editingModeState);\r\n\r\n  const filteredOperations = useMemo(() => {\r\n    // If neither are specified then allow the full range of operations\r\n    if (!allowedTransformOperations && !allowedAdjustmentOperations) {\r\n      return operations;\r\n    }\r\n    const filteredTransforms = allowedTransformOperations\r\n      ? operations.transform.filter((op) =>\r\n          allowedTransformOperations.includes(op.operationID)\r\n        )\r\n      : operations.transform;\r\n    const filteredAdjustments = allowedAdjustmentOperations\r\n      ? operations.adjust.filter((op) =>\r\n          allowedAdjustmentOperations.includes(op.operationID)\r\n        )\r\n      : operations.adjust;\r\n    if (isTransformOnly) {\r\n      return { transform: filteredTransforms, adjust: [] };\r\n    }\r\n    if (isAdjustmentOnly) {\r\n      return { adjust: filteredAdjustments, transform: [] };\r\n    }\r\n    return { transform: filteredTransforms, adjust: filteredAdjustments };\r\n  }, [\r\n    allowedTransformOperations,\r\n    allowedAdjustmentOperations,\r\n    isTransformOnly,\r\n    isAdjustmentOnly,\r\n  ]);\r\n\r\n  return (\r\n    <>\r\n      <ScrollView style={styles.opRow} horizontal>\r\n        {\r\n          //@ts-ignore\r\n          filteredOperations[selectedOperationGroup].map(\r\n            (item: Operation<EditingOperations>, index: number) => (\r\n              <View style={styles.opContainer} key={item.title}>\r\n                <IconButton\r\n                  text={item.title}\r\n                  iconID={item.iconID}\r\n                  onPress={() => setEditingMode(item.operationID)}\r\n                />\r\n              </View>\r\n            )\r\n          )\r\n        }\r\n      </ScrollView>\r\n      {!isTransformOnly && !isAdjustmentOnly ? (\r\n        <View style={styles.modeRow}>\r\n          <TouchableOpacity\r\n            style={[\r\n              styles.modeButton,\r\n              selectedOperationGroup === \"transform\" && {\r\n                backgroundColor: \"#333\",\r\n              },\r\n            ]}\r\n            onPress={() => setSelectedOperationGroup(\"transform\")}\r\n          >\r\n            <Icon iconID=\"transform\" text=\"Transform\" />\r\n          </TouchableOpacity>\r\n          <TouchableOpacity\r\n            style={[\r\n              styles.modeButton,\r\n              selectedOperationGroup === \"adjust\" && {\r\n                backgroundColor: \"#333\",\r\n              },\r\n            ]}\r\n            onPress={() => setSelectedOperationGroup(\"adjust\")}\r\n          >\r\n            <Icon iconID=\"tune\" text=\"Adjust\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n      ) : null}\r\n    </>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  opRow: {\r\n    height: 80,\r\n    width: \"100%\",\r\n    backgroundColor: \"#333\",\r\n  },\r\n  opContainer: {\r\n    height: \"100%\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    marginLeft: 16,\r\n  },\r\n  modeRow: {\r\n    height: 80,\r\n    width: \"100%\",\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-around\",\r\n  },\r\n  modeButton: {\r\n    height: 80,\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    backgroundColor: \"#222\",\r\n  },\r\n});\r\n"]}